kind: pipeline
type: docker
name: automation_poc_pipeline

platform:
  os: linux
  arch: amd64

steps:
- name: Install packages
  image: node:16-alpine
  commands:
  - npm install

# - name: Lint and test
#   image: node:16
#   commands: 
#   - npm run lint
#   - npm run test

- name : Build and deploy
  image: node:16
  environment:
    CDK_AWS_ACCOUNT_ID:
      from_secret: CDK_AWS_ACCOUNT_ID
    CDK_AWS_REGION: us-west-2
    CDK_VPC_ID:
      from_secret: CDK_VPC_ID
    CDK_STORAGE_PREFIX_CUCUMBER: /cucumber
    DB_HOST:
      from_secret: DB_HOST
    DB_PORT: 3306
    DB_USERNAME: admin
    DB_PASSWORD:
      from_secret: DB_PASSWORD
    DB_NAME: qa_reports
    PERSISTENCE_LAMBDA_TIMEOUT: 30
    FORMAT_LAMBDA_TIMEOUT: 60
    SCREENSHOT_BUCKET_NAME: qa-report-poc-federico-screenshots
    AWS_ACCESS_KEY:
      from_secret: AWS_ACCESS_KEY
    AWS_SECRET_ACCESS_KEY:
      from_secret: AWS_SECRET_ACCESS_KEY
    AWS_DEFAULT_REGION:
      from_secret: AWS_DEFAULT_REGION

  commands: 
  - npm run build
  - npm run deploy
    
